{
	"name": "dataflowfinal",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "output_mongo",
						"type": "DatasetReference"
					},
					"name": "Mongo"
				},
				{
					"dataset": {
						"referenceName": "ouput_data",
						"type": "DatasetReference"
					},
					"name": "BDRelacional"
				},
				{
					"dataset": {
						"referenceName": "SalidaAmesCSV",
						"type": "DatasetReference"
					},
					"name": "CSV"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "output_final",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "MongoBDRelacional"
				},
				{
					"name": "MongoBDRelacionalCSV"
				},
				{
					"name": "PIDUnificado"
				},
				{
					"name": "EliminarOtrosPID"
				},
				{
					"name": "nulos"
				},
				{
					"name": "derivedColumn1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          PID as string,",
				"          {Bsmt Qual} as string,",
				"          {Bsmt Cond} as string,",
				"          {Bsmt Exposure} as string,",
				"          {BsmtFin Type 1} as string,",
				"          {BsmtFin SF 1} as integer,",
				"          {BsmtFin Type 2} as string,",
				"          {BsmtFin SF 2} as integer,",
				"          {Bsmt Unf SF} as integer,",
				"          {Total Bsmt SF} as integer,",
				"          {Bsmt Full Bath} as integer,",
				"          {Bsmt Half Bath} as integer,",
				"          {Garage Type} as string,",
				"          {Garage Yr Blt} as integer,",
				"          {Garage Finish} as string,",
				"          {Garage Cars} as integer,",
				"          {Garage Area} as integer,",
				"          {Garage Qual} as string,",
				"          {Garage Cond} as string,",
				"          {Misc Feature} as string,",
				"          {Misc Val} as integer,",
				"          {Pool Area} as integer,",
				"          {Pool QC} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> Mongo",
				"source(output(",
				"          PID as string,",
				"          {MS SubClass} as integer,",
				"          {MS Zoning} as string,",
				"          {Roof Style} as string,",
				"          {Roof Matl} as string,",
				"          {Exterior 1st} as string,",
				"          {Exterior 2nd} as string,",
				"          {Mas Vnr Type} as string,",
				"          {Mas Vnr Area} as integer,",
				"          {Exter Qual} as string,",
				"          {Exter Cond} as string,",
				"          Foundation as string,",
				"          Heating as string,",
				"          {Heating QC} as string,",
				"          {Central Air} as string,",
				"          Electrical as string,",
				"          {1st Flr SF} as integer,",
				"          {2nd Flr SF} as integer,",
				"          {Low Qual Fin SF} as integer,",
				"          {Gr Liv Area} as integer,",
				"          FullBath as integer,",
				"          HalfBath as integer,",
				"          {Bedrooms  AbvGr} as integer,",
				"          {Kitchen AbvGr} as integer,",
				"          {Kitchen Qual} as string,",
				"          {TotRms AbvGrd} as integer,",
				"          Functional as string,",
				"          fireplaces as integer,",
				"          {Fireplace Qu} as string,",
				"          {Paved Drive} as string,",
				"          {Wood Deck SF} as short,",
				"          {Open Porch SF} as short,",
				"          {Enclosed Porch} as short,",
				"          {3Ssn Porch} as short,",
				"          {Screen Porch} as short,",
				"          Fence as string,",
				"          MoSold as integer,",
				"          YrSold as integer,",
				"          {Sale Type} as string,",
				"          {Sale Condition} as string,",
				"          saleprice as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     partitionBy('hash', 1)) ~> BDRelacional",
				"source(output(",
				"          PID as string,",
				"          {Lot Frontage} as integer,",
				"          {Lot Area} as integer,",
				"          Street as string,",
				"          Alley as string,",
				"          LotShape as string,",
				"          {Land Contour} as string,",
				"          Utilities as string,",
				"          {Lot Config} as string,",
				"          {Land Slope} as string,",
				"          Neighborhood as string,",
				"          Condition1 as string,",
				"          Condition2 as string,",
				"          {Bldg Type} as string,",
				"          {House Style} as string,",
				"          {Overall Qual} as integer,",
				"          {Overall Cond} as integer,",
				"          YearBuilt as integer,",
				"          YearRemodAdd as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> CSV",
				"Mongo, BDRelacional join(Mongo@PID == BDRelacional@PID,",
				"     joinType:'outer',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> MongoBDRelacional",
				"MongoBDRelacional, CSV join(BDRelacional@PID == CSV@PID,",
				"     joinType:'outer',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> MongoBDRelacionalCSV",
				"MongoBDRelacionalCSV derive(PIDUnificado = iif(     !isNull(Mongo@PID) && Mongo@PID != '',     Mongo@PID,     iif(         !isNull(BDRelacional@PID) && BDRelacional@PID != '',         BDRelacional@PID,         CSV@PID     ) )) ~> PIDUnificado",
				"PIDUnificado select(mapColumn(",
				"          PID = PIDUnificado,",
				"          {Bsmt Qual},",
				"          {Bsmt Cond},",
				"          {Bsmt Exposure},",
				"          {BsmtFin Type 1},",
				"          {BsmtFin SF 1},",
				"          {BsmtFin Type 2},",
				"          {BsmtFin SF 2},",
				"          {Bsmt Unf SF},",
				"          {Total Bsmt SF},",
				"          {Bsmt Full Bath},",
				"          {Bsmt Half Bath},",
				"          {Garage Type},",
				"          {Garage Yr Blt},",
				"          {Garage Finish},",
				"          {Garage Cars},",
				"          {Garage Area},",
				"          {Garage Qual},",
				"          {Garage Cond},",
				"          {Misc Feature},",
				"          {Misc Val},",
				"          {Pool Area},",
				"          {Pool QC},",
				"          {MS SubClass},",
				"          {MS Zoning},",
				"          {Roof Style},",
				"          {Roof Matl},",
				"          {Exterior 1st},",
				"          {Exterior 2nd},",
				"          {Mas Vnr Type},",
				"          {Mas Vnr Area},",
				"          {Exter Qual},",
				"          {Exter Cond},",
				"          Foundation,",
				"          Heating,",
				"          {Heating QC},",
				"          {Central Air},",
				"          Electrical,",
				"          {1st Flr SF},",
				"          {2nd Flr SF},",
				"          {Low Qual Fin SF},",
				"          {Gr Liv Area},",
				"          FullBath,",
				"          HalfBath,",
				"          {Bedrooms  AbvGr},",
				"          {Kitchen AbvGr},",
				"          {Kitchen Qual},",
				"          {TotRms AbvGrd},",
				"          Functional,",
				"          fireplaces,",
				"          {Fireplace Qu},",
				"          {Paved Drive},",
				"          {Wood Deck SF},",
				"          {Open Porch SF},",
				"          {Enclosed Porch},",
				"          {3Ssn Porch},",
				"          {Screen Porch},",
				"          Fence,",
				"          MoSold,",
				"          YrSold,",
				"          {Sale Type},",
				"          {Sale Condition},",
				"          saleprice,",
				"          {Lot Frontage},",
				"          {Lot Area},",
				"          Street,",
				"          Alley,",
				"          LotShape,",
				"          {Land Contour},",
				"          Utilities,",
				"          {Lot Config},",
				"          {Land Slope},",
				"          Neighborhood,",
				"          Condition1,",
				"          Condition2,",
				"          {Bldg Type},",
				"          {House Style},",
				"          {Overall Qual},",
				"          {Overall Cond},",
				"          YearBuilt,",
				"          YearRemodAdd",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> EliminarOtrosPID",
				"derivedColumn1 derive({Bsmt Qual} = iif(isNull({Bsmt Qual}), 'NA', {Bsmt Qual}),",
				"          {Bsmt Cond} = iif(isNull({Bsmt Cond}), 'NA', {Bsmt Cond}),",
				"          {Bsmt Exposure} = iif(isNull({Bsmt Exposure}), 'NA', {Bsmt Exposure}),",
				"          {BsmtFin Type 1} = iif(isNull({BsmtFin Type 1}), 'NA', {BsmtFin Type 1}),",
				"          {BsmtFin SF 1} = iif(isNull({BsmtFin SF 1}), 0, {BsmtFin SF 1}),",
				"          {BsmtFin Type 2} = iif(isNull({BsmtFin Type 2}), 'NA', {BsmtFin Type 2}),",
				"          {BsmtFin SF 2} = iif(isNull({BsmtFin SF 2}), 0, {BsmtFin SF 2}),",
				"          {Bsmt Unf SF} = iif(isNull({Bsmt Unf SF}), 0, {Bsmt Unf SF}),",
				"          {Total Bsmt SF} = iif(isNull({Total Bsmt SF}), 0, {Total Bsmt SF}),",
				"          {Bsmt Full Bath} = iif(isNull({Bsmt Full Bath}), 0, {Bsmt Full Bath}),",
				"          {Bsmt Half Bath} = iif(isNull({Bsmt Half Bath}), 0, {Bsmt Half Bath}),",
				"          {Garage Type} = iif(isNull({Garage Type}), 'NA', {Garage Type}),",
				"          {Garage Yr Blt} = iif(isNull({Garage Yr Blt}), 0, {Garage Yr Blt}),",
				"          {Garage Finish} = iif(isNull({Garage Finish}), 'NA', {Garage Finish}),",
				"          {Garage Cars} = iif(isNull({Garage Cars}), 0, {Garage Cars}),",
				"          {Garage Area} = iif(isNull({Garage Area}), 0, {Garage Area}),",
				"          {Garage Qual} = iif(isNull({Garage Qual}), 'NA', {Garage Qual}),",
				"          {Garage Cond} = iif(isNull({Garage Cond}), 'NA', {Garage Cond}),",
				"          {Misc Feature} = iif(isNull({Misc Feature}), 'NA', {Misc Feature}),",
				"          {Misc Val} = iif(isNull({Misc Val}), 0, {Misc Val}),",
				"          {Pool Area} = iif(isNull({Pool Area}), 0, {Pool Area}),",
				"          {Pool QC} = iif(isNull({Pool QC}), 'NA', {Pool QC}),",
				"          {MS SubClass} = iif(isNull({MS SubClass}), 0, {MS SubClass}),",
				"          {MS Zoning} = iif(isNull({MS Zoning}), 'NA', {MS Zoning}),",
				"          {Roof Style} = iif(isNull({Roof Style}), 'NA', {Roof Style}),",
				"          {Roof Matl} = iif(isNull({Roof Matl}), 'NA', {Roof Matl}),",
				"          {Exterior 1st} = iif(isNull({Exterior 1st}), 'NA', {Exterior 1st}),",
				"          {Exterior 2nd} = iif(isNull({Exterior 2nd}), 'NA', {Exterior 2nd}),",
				"          {Mas Vnr Type} = iif(isNull({Mas Vnr Type}), 'NA', {Mas Vnr Type}),",
				"          {Mas Vnr Area} = iif(isNull({Mas Vnr Area}), 0, {Mas Vnr Area}),",
				"          {Exter Qual} = iif(isNull({Exter Qual}), 'NA', {Exter Qual}),",
				"          {Exter Cond} = iif(isNull({Exter Cond}), 'NA', {Exter Cond}),",
				"          Foundation = iif(isNull(Foundation), 'NA', Foundation),",
				"          Heating = iif(isNull(Heating), 'NA', Heating),",
				"          {Heating QC} = iif(isNull({Heating QC}), 'NA', {Heating QC}),",
				"          {Central Air} = iif(isNull({Central Air}), \"NA\", {Central Air}),",
				"          Electrical = iif(isNull(Electrical), 'NA', Electrical),",
				"          {1st Flr SF} = iif(isNull({1st Flr SF}), 0, {1st Flr SF}),",
				"          {2nd Flr SF} = iif(isNull({2nd Flr SF}), 0, {2nd Flr SF}),",
				"          {Low Qual Fin SF} = iif(isNull({Low Qual Fin SF}), 0, {Low Qual Fin SF}),",
				"          {Gr Liv Area} = iif(isNull({Gr Liv Area}), 0, {Gr Liv Area}),",
				"          FullBath = iif(isNull(FullBath), 0, FullBath),",
				"          HalfBath = iif(isNull(HalfBath), 0, HalfBath),",
				"          {Bedrooms  AbvGr} = iif(isNull({Bedrooms  AbvGr}), 0, {Bedrooms  AbvGr}),",
				"          {Kitchen Qual} = iif(isNull({Kitchen Qual}), 'NA', {Kitchen Qual}),",
				"          {TotRms AbvGrd} = iif(isNull({TotRms AbvGrd}), 0, {TotRms AbvGrd}),",
				"          Functional = iif(isNull(Functional), 'NA', Functional)) ~> nulos",
				"EliminarOtrosPID derive(each(match(type == 'string'), $$ = iif(isNull($$), 'NA', $$)),",
				"          each(match(type == 'integer'), $$ = iif(isNull($$), toInteger(0), $$))) ~> derivedColumn1",
				"nulos sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     partitionFileNames:['output_final.csv'],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> sink1"
			]
		}
	}
}