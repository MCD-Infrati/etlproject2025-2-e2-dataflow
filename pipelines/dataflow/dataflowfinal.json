{
	"name": "dataflowfinal",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "output_mongo",
						"type": "DatasetReference"
					},
					"name": "Mongo"
				},
				{
					"dataset": {
						"referenceName": "ouput_data",
						"type": "DatasetReference"
					},
					"name": "BDRelacional"
				},
				{
					"dataset": {
						"referenceName": "SalidaAmesCSV",
						"type": "DatasetReference"
					},
					"name": "CSV"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "output_final",
						"type": "DatasetReference"
					},
					"name": "sink1",
					"description": "Exportar datos a output_final"
				}
			],
			"transformations": [
				{
					"name": "MongoBDRelacional"
				},
				{
					"name": "EliminarOtrosPID",
					"description": "Se estÃ¡ cambiando el nombre de PIDUnificado a PID y eliminando las otras columnas de PID"
				},
				{
					"name": "PIDUnificado",
					"description": "Combinando columnas de PID para dejar una sola columna\n"
				},
				{
					"name": "MongoBDRelacionalCSV"
				}
			],
			"scriptLines": [
				"source(output(",
				"          PID as string,",
				"          {Bsmt Qual} as string,",
				"          {Bsmt Cond} as string,",
				"          {Bsmt Exposure} as string,",
				"          {BsmtFin Type 1} as string,",
				"          {BsmtFin SF 1} as short,",
				"          {BsmtFin Type 2} as string,",
				"          {BsmtFin SF 2} as short,",
				"          {Bsmt Unf SF} as short,",
				"          {Total Bsmt SF} as short,",
				"          {Bsmt Full Bath} as short,",
				"          {Bsmt Half Bath} as short,",
				"          {Garage Type} as string,",
				"          {Garage Yr Blt} as short,",
				"          {Garage Finish} as string,",
				"          {Garage Cars} as short,",
				"          {Garage Area} as short,",
				"          {Garage Qual} as string,",
				"          {Garage Cond} as string,",
				"          {Misc Feature} as string,",
				"          {Misc Val} as short,",
				"          {Pool Area} as short,",
				"          {Pool QC} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> Mongo",
				"source(output(",
				"          PID as integer,",
				"          {MS SubClass} as short,",
				"          {MS Zoning} as string,",
				"          {Roof Style} as string,",
				"          {Roof Matl} as string,",
				"          {Exterior 1st} as string,",
				"          {Exterior 2nd} as string,",
				"          {Mas Vnr Type} as string,",
				"          {Mas Vnr Area} as short,",
				"          {Exter Qual} as string,",
				"          {Exter Cond} as string,",
				"          Foundation as string,",
				"          Heating as string,",
				"          {Heating QC} as string,",
				"          {Central Air} as boolean,",
				"          Electrical as string,",
				"          {1st Flr SF} as short,",
				"          {2nd Flr SF} as short,",
				"          {Low Qual Fin SF} as short,",
				"          {Gr Liv Area} as short,",
				"          FullBath as short,",
				"          HalfBath as short,",
				"          {Bedrooms  AbvGr} as short,",
				"          {Kitchen AbvGr} as short,",
				"          {Kitchen Qual} as string,",
				"          {TotRms AbvGrd} as short,",
				"          Functional as string,",
				"          fireplaces as short,",
				"          {Fireplace Qu} as string,",
				"          {Paved Drive} as string,",
				"          {Wood Deck SF} as short,",
				"          {Open Porch SF} as short,",
				"          {Enclosed Porch} as short,",
				"          {3Ssn Porch} as short,",
				"          {Screen Porch} as short,",
				"          Fence as string,",
				"          MoSold as short,",
				"          YrSold as short,",
				"          {Sale Type} as string,",
				"          {Sale Condition} as string,",
				"          saleprice as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     partitionBy('hash', 1)) ~> BDRelacional",
				"source(output(",
				"          {PID;Lot Frontage;Lot Area;Street;Alley;Lot Shape;Land Contour;Utilities;Lot Config;Land Slope;Neighborhood;Condition 1;Condition 2;Bldg Type;House Style;Overall Qual;Overall Cond;Year Built;Year Remod/Add} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> CSV",
				"Mongo, BDRelacional join(Mongo@PID == BDRelacional@PID,",
				"     joinType:'outer',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> MongoBDRelacional",
				"PIDUnificado select(mapColumn(",
				"          PID_unificado,",
				"          {Bsmt Qual},",
				"          {Bsmt Cond},",
				"          {Bsmt Exposure},",
				"          {BsmtFin Type 1},",
				"          {BsmtFin SF 1},",
				"          {BsmtFin Type 2},",
				"          {BsmtFin SF 2},",
				"          {Bsmt Unf SF},",
				"          {Total Bsmt SF},",
				"          {Bsmt Full Bath},",
				"          {Bsmt Half Bath},",
				"          {Garage Type},",
				"          {Garage Yr Blt},",
				"          {Garage Finish},",
				"          {Garage Cars},",
				"          {Garage Area},",
				"          {Garage Qual},",
				"          {Garage Cond},",
				"          {Misc Feature},",
				"          {Misc Val},",
				"          {Pool Area},",
				"          {Pool QC},",
				"          {MS SubClass},",
				"          {MS Zoning},",
				"          {Roof Style},",
				"          {Roof Matl},",
				"          {Exterior 1st},",
				"          {Exterior 2nd},",
				"          {Mas Vnr Type},",
				"          {Mas Vnr Area},",
				"          {Exter Qual},",
				"          {Exter Cond},",
				"          Foundation,",
				"          Heating,",
				"          {Heating QC},",
				"          {Central Air},",
				"          electrical,",
				"          {1st Flr SF},",
				"          {2nd Flr SF},",
				"          {Low Qual Fin SF},",
				"          FullBath,",
				"          HalfBath,",
				"          {Bedrooms AbvGr},",
				"          {Kitchen AbvGr},",
				"          {Kitchen Qual},",
				"          {TotRms AbvGrd},",
				"          Functional,",
				"          Fireplaces,",
				"          {Fireplace Qu},",
				"          {Paved Drive},",
				"          {Wood Deck SF},",
				"          {Open Porch SF},",
				"          {Enclosed Porch},",
				"          {3Ssn Porch},",
				"          {Screen Porch},",
				"          Fence,",
				"          MoSold,",
				"          YrSold,",
				"          {Sale Type},",
				"          {Sale Condition},",
				"          saleprice",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> EliminarOtrosPID",
				"MongoBDRelacionalCSV derive(PID_unificado = iif(\r",
				"    !isNull(Mongo@PID) && Mongo@PID != '',\r",
				"    Mongo@PID,\r",
				"    iif(\r",
				"        !isNull(BDRelacional@PID) && BDRelacional@PID != '',\r",
				"        BDRelacional@PID,\r",
				"        {{PID;Lot Frontage;Lot Area;Street;Alley;Lot Shape;Land Contour;Utilities;Lot Config;Land Slope;Neighborhood;Condition 1;Condition 2;Bldg Type;House Style;Overall Qual;Overall Cond;Year Built;Year Remod/Add}}\r",
				"    )\r",
				")) ~> PIDUnificado",
				"MongoBDRelacional, CSV join(Mongo@PID == {PID;Lot Frontage;Lot Area;Street;Alley;Lot Shape;Land Contour;Utilities;Lot Config;Land Slope;Neighborhood;Condition 1;Condition 2;Bldg Type;House Style;Overall Qual;Overall Cond;Year Built;Year Remod/Add},",
				"     joinType:'outer',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> MongoBDRelacionalCSV",
				"EliminarOtrosPID sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sink1"
			]
		}
	}
}